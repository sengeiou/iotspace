webpackJsonp([25],{"C+tK":function(e,t){},H1qQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l={components:{fileupload:a("2t8s").a},filters:{formatDate:function(e){var t=new Date(e),a=t.getFullYear(),l=t.getMonth()+1,r=t.getDate(),o=t.getHours(),i=t.getMinutes();return l<10&&(l="0"+l),o<10&&(o="0"+o),i<10&&(i="0"+i),a+"-"+l+"-"+r+" "+o+":"+i}},data:()=>({page:1,pageSize:10,totalNum:100,categoryVisible:!1,categoryText:"",categoryFlag:null,form:{type:null,starttime:"",endtime:"",categoryid:null},addOrUpTit:"",addForm:{id:null,treatmentplantid:sessionStorage.getItem("belongId"),name:null,type:null,number:null,unitprice:null,address:null,contract:null,no:null,categoryid:null,weight:null,totalprice:null,car:null,phone:null,invoice:null,note:null,treatmentplantid:null,username:null},tableData:[],tableTypes:[],sourceList:[],xiaoshouTypeList:[],TypeList:[],TypeAddList:[],multipleSelection:[],centerDialogVisible:!1,endPickerOptions:{disabledDate:e=>e.getTime()<Date.now()-864e5},weightText:"请输入重量",weightNumver:0}),mounted(){this.getData(),this.getSelectList()},watch:{addForm:function(e,t){console.log(e)}},methods:{lookCategory(e){var t=this;this.$ajax.get("/recovery/order/selectByCategory",{params:{type:e.type,categoryid:e.categoryid}}).then(function(e){console.log("类别",e),260==e.data.status&&(t.categoryText=e.data.object.name,t.categoryVisible=!0)})},getFileUrl(e){console.log("销售合同附件",e),this.addForm.contract=e},delFile(e){this.addForm.contract=null},getFileUrls(e){console.log("发票附件",e),this.addForm.invoice=e},delFiles(e){this.addForm.invoice=null},selectCategoryList(e,t){console.log(e,t);var a,l=this,r={id:"",name:"全部"};1==t?this.form.categoryid=null:2==t&&(this.addForm.categoryid=null),this.categoryFlag=e,"破碎料"==e?a="/recovery/cmaterialcategory/selectByTreatmentplantid":"颗粒料"==e&&(a="/recovery/gmaterialcategory/selectByTreatmentplantid"),this.$ajax.get(a,{params:{treatmentplantid:sessionStorage.getItem("belongId")}}).then(function(e){console.log("类别",e),1==t?(l.TypeList=e.data.list,l.TypeList.unshift(r)):2==t&&(l.TypeAddList=e.data.list,l.TypeAddList.unshift(r))})},getWeight(){var e,t=this;"破碎料"==this.categoryFlag?e="/recovery/cmaterialcategory/selectByPrimaryKey":"颗粒料"==this.categoryFlag&&(e="/recovery/gmaterialcategory/selectByPrimaryKey"),this.$ajax.get(e,{params:{id:t.addForm.categoryid}}).then(function(e){console.log("库存重量",e),260==e.data.status?(t.weightText="库存剩余"+e.data.object.stock+"kg",t.weightNumber=e.data.object.stock):(t.weightText="请输入重量",t.weightNumber=0)})},getSelectList(){var e=this,t={value:"",text:"全部"};this.$ajax.get("/recovery/order/typeList").then(function(a){console.log("销售类别",a),e.xiaoshouTypeList=a.data.list,e.xiaoshouTypeList.unshift(t)})},getData(){var e=this;null==this.form.starttime&&(this.form.starttime=""),null==this.form.endtime&&(this.form.endtime=""),this.$ajax.get("/recovery/order/selectByPage",{params:{page:this.page,rows:this.pageSize,treatmentplantid:sessionStorage.getItem("belongId"),type:this.form.type,begintime:""==this.form.starttime?"":new Date(this.form.starttime)/1e3*1e3,endtime:""==this.form.endtime?"":new Date(this.form.endtime)/1e3*1e3}}).then(function(t){console.log(t),260==t.data.status?(e.tableData=t.data.list,e.totalNum=t.data.info.total):(e.tableData=[],e.totalNum=0)})},changePage(e){this.page=e,this.getData()},selectList(){this.page=1,this.getData()},clearSelect(){this.form={type:"",starttime:"",endtime:"",source:""},this.getData()},clearForm(){this.addForm={id:null,treatmentplantid:sessionStorage.getItem("belongId"),name:null,type:null,number:null,unitprice:null,address:null,contract:null,no:null,categoryid:null,weight:null,totalprice:null,car:null,phone:null,invoice:null,note:null,username:null}},clickAddOrUp(){this.centerDialogVisible=!0,this.addOrUpTit="新增订单",this.clearForm()},handleEdit(e,t){console.log(e,t);this.centerDialogVisible=!0,this.addOrUpTit="编辑订单",this.addForm={id:t.id,treatmentplantid:t.treatmentplantid,name:t.name,type:t.type,number:t.number,unitprice:t.unitprice,address:t.address,contract:t.contract,no:t.no,categoryid:t.categoryid,weight:t.weight,totalprice:t.totalprice,car:t.car,phone:t.phone,invoice:t.invoice,note:t.note,username:t.username}},addSaveForm(e){if(console.log(this.addForm),null!=this.addForm.treatmentplantid&&null!=this.addForm.name&&null!=this.addForm.type&&null!=this.addForm.number&&null!=this.addForm.unitprice&&null!=this.addForm.address&&null!=this.addForm.categoryid&&null!=this.addForm.weight&&null!=this.addForm.totalprice&&null!=this.addForm.car&&null!=this.addForm.phone&&null!=this.addForm.username)if(Number(this.addForm.weight)>Number(this.weightNumber))this.$message.error("销售重量库存不足！");else{var t=this,a=this.$qs.stringify(this.addForm,{indices:!1});"新增订单"==this.addOrUpTit?this.$ajax.post("/recovery/order/insert",a).then(function(e){260==e.data.status&&(t.centerDialogVisible=!1,t.$message.success("添加成功"),t.getData(),t.clearForm())}):this.$ajax.put("/recovery/order/update",a).then(function(e){260==e.data.status&&(t.centerDialogVisible=!1,t.$message.success("编辑成功"),t.getData(),t.clearForm())})}else this.$message.error("*为必填项！")},delAll(){if(this.multipleSelection.length<1)return this.$message.success("请先选择删除对象");this.$confirm("此操作将永久删除选中的订单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.multipleSelection.length==this.tableData.length&&(this.page=Number(this.page)-1);var e=this;this.$ajax.delete("/recovery/order/deletes",{data:this.multipleSelection}).then(function(t){260==t.data.status&&(e.$message.success("删除成功"),e.getData())})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},handleSelectionChange(e){this.multipleSelection=[];for(var t=0;t<e.length;t++)this.multipleSelection.push(e[t].id);console.log(this.multipleSelection)},handleDelete(e,t){this.$confirm("此操作将删除该订单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{console.log(e,t),1==this.tableData.length&&(this.page=Number(this.page)-1);var a=this;this.$ajax.delete("/recovery/order/delete",{params:{id:t}}).then(function(e){260==e.data.status&&(a.$message.success("删除成功"),a.getData())})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"orderBox"}},[a("div",{staticClass:"selectBox"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"销售类型"}},[a("el-select",{attrs:{placeholder:"请选择销售类型"},on:{change:function(t){return e.selectCategoryList(e.form.type,1)}},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.xiaoshouTypeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.text,value:e.value}})}),1)],1),e._v(" "),null!=e.form.type?a("el-form-item",{attrs:{label:"类别"}},[a("el-select",{attrs:{placeholder:"请选择类别"},on:{change:e.selectList},model:{value:e.form.categoryid,callback:function(t){e.$set(e.form,"categoryid",t)},expression:"form.categoryid"}},e._l(e.TypeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"时间"}},[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"起始日期","value-format":"yyyy/MM/dd"},on:{change:e.selectList},model:{value:e.form.starttime,callback:function(t){e.$set(e.form,"starttime",t)},expression:"form.starttime"}})],1),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"结束日期","value-format":"yyyy/MM/dd"},on:{change:e.selectList},model:{value:e.form.endtime,callback:function(t){e.$set(e.form,"endtime",t)},expression:"form.endtime"}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"warning",size:"small"},on:{click:e.clearSelect}},[e._v("清空筛选")])],1)],1)],1),e._v(" "),a("div",{staticClass:"tableBox"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"time",label:"时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("formatDate")(t.row.time))+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"销售客户"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"销售类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"类别"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.lookCategory(t.row)}}},[e._v("查看")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"number",label:"数量(袋)"}}),e._v(" "),a("el-table-column",{attrs:{prop:"weight",label:"重量(kg)"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"销售地址"}}),e._v(" "),a("el-table-column",{attrs:{prop:"car",label:"运输车辆"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"联系电话"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unitprice",label:"单价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"totalprice",label:"总价"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"出库人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"发票",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary",href:t.row.invoice,disabled:null==t.row.invoice}},[e._v("下载发票")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"购销合同",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary",href:t.row.contract,disabled:null==t.row.contract}},[e._v("下载附件")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"note",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")])]}}])})],1),e._v(" "),a("div",{staticClass:"pafinationBox"},[a("div",[a("el-button",{attrs:{type:"primary"},on:{click:e.clickAddOrUp}},[e._v("新增订单")])],1),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.pageSize,total:e.totalNum},on:{"current-change":e.changePage}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.addOrUpTit,visible:e.centerDialogVisible,width:"50%",top:"5vh",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("div",{staticClass:"dialogMain"},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"销售客户",required:""}},[a("el-input",{attrs:{placeholder:"请输入销售客户"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"销售类型",required:""}},[a("el-select",{attrs:{placeholder:"请选择销售类型"},on:{change:function(t){return e.selectCategoryList(e.addForm.type,2)}},model:{value:e.addForm.type,callback:function(t){e.$set(e.addForm,"type",t)},expression:"addForm.type"}},e._l(e.xiaoshouTypeList,function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:"全部"!=e.text,expression:"item.text != '全部'"}],key:t,attrs:{label:e.text,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"类别",required:""}},[a("el-select",{attrs:{placeholder:"请选择类别"},on:{change:e.getWeight},model:{value:e.addForm.categoryid,callback:function(t){e.$set(e.addForm,"categoryid",t)},expression:"addForm.categoryid"}},e._l(e.TypeAddList,function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:"全部"!=e.name,expression:"item.name != '全部'"}],key:t,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"重量",required:""}},[a("el-input",{attrs:{placeholder:e.weightText},model:{value:e.addForm.weight,callback:function(t){e.$set(e.addForm,"weight",t)},expression:"addForm.weight"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"袋数",required:""}},[a("el-input",{attrs:{placeholder:"请输入袋数"},model:{value:e.addForm.number,callback:function(t){e.$set(e.addForm,"number",t)},expression:"addForm.number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"销售地址",required:""}},[a("el-input",{attrs:{placeholder:"请输入销售地址"},model:{value:e.addForm.address,callback:function(t){e.$set(e.addForm,"address",t)},expression:"addForm.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"运输车辆",required:""}},[a("el-input",{attrs:{placeholder:"请输入运输车辆"},model:{value:e.addForm.car,callback:function(t){e.$set(e.addForm,"car",t)},expression:"addForm.car"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话",required:""}},[a("el-input",{attrs:{placeholder:"请输入联系电话"},model:{value:e.addForm.phone,callback:function(t){e.$set(e.addForm,"phone",t)},expression:"addForm.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"单价",required:""}},[a("el-input",{attrs:{placeholder:"请输入单价"},model:{value:e.addForm.unitprice,callback:function(t){e.$set(e.addForm,"unitprice",t)},expression:"addForm.unitprice"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"总价",required:""}},[a("el-input",{attrs:{placeholder:"请输入总价"},model:{value:e.addForm.totalprice,callback:function(t){e.$set(e.addForm,"totalprice",t)},expression:"addForm.totalprice"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"出库人",required:""}},[a("el-input",{attrs:{placeholder:"请输入出库人"},model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.addForm.note,callback:function(t){e.$set(e.addForm,"note",t)},expression:"addForm.note"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"购销合同"}},[a("fileupload",{attrs:{directory:"order",file:e.addForm.contract},on:{delFile:e.delFile,fileUrl:e.getFileUrl}})],1),e._v(" "),a("el-form-item",{attrs:{label:"发票"}},[a("fileupload",{attrs:{directory:"order",file:e.addForm.invoice},on:{delFile:e.delFiles,fileUrl:e.getFileUrls}})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addSaveForm()}}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"类别",visible:e.categoryVisible,width:"200px"},on:{"update:visible":function(t){e.categoryVisible=t}}},[a("span",[e._v(e._s(e.categoryText))])])],1)},staticRenderFns:[]};var o=a("VU/8")(l,r,!1,function(e){a("C+tK")},"data-v-7d4ce0e4",null);t.default=o.exports}});
//# sourceMappingURL=25.42bf6ca323cc6e5761e4.js.map