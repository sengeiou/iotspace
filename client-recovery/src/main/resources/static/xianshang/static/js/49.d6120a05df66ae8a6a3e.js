webpackJsonp([49],{UEwu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={components:{aliUpFile:a("2R99").a},filters:{formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,l=t.getDate(),s=t.getHours(),n=t.getMinutes();return i<10&&(i="0"+i),s<10&&(s="0"+s),n<10&&(n="0"+n),a+"-"+i+"-"+l+" "+s+":"+n}},data:()=>({userType:sessionStorage.getItem("userType"),page:1,pageSize:10,totalNum:100,form:{item:"",leadername:""},shengchanIf:!1,joinid:null,jpage:1,jpageSize:5,jtotalNum:100,joinForm:{treatmentplantid:null,status:null,submitid:null,starttime:null,endtime:null,confirmid:null},joinTableData:[],treatmentplantList:[],submitList:[],statusList:[],confirmList:[],addOrUpTit:"",addForm:{id:null,item:null,leadername:null,leaderphone:null,address:null,img:""},tableData:[],multipleSelection:[],centerDialogVisible:!1,innerVisible:!1,endPickerOptions:{disabledDate:e=>e.getTime()<Date.now()-864e5},lookImgIf:!1,imgLook:""}),mounted(){this.getData(),this.getJoinSelectList()},methods:{upFileDatas(e){this.addForm.img=e},fileDels(e){this.addForm.img=""},lookImg(e){this.imgLook=e,this.lookImgIf=!0},setAdminUser(e){this.$router.replace({path:"/adminUser",query:{belongid:e.id,gsName:e.name,type:"再利用企业"}})},lookJoinList(e){this.joinid=e,this.shengchanIf=!0},getData(){var e=this;this.$ajax.get("/recovery/productionplant/selectByPage",{params:{page:this.page,rows:this.pageSize,name:this.form.item,leadername:this.form.leadername}}).then(function(t){console.log(t),260==t.data.status?(e.tableData=t.data.list,e.totalNum=t.data.info.total):(e.tableData=[],e.totalNum=0)})},changePage(e){this.page=e,this.getData()},selectList(){this.page=1,this.getData()},clearSelect(){this.form={item:"",leadername:""},this.getData()},clearForm(){this.addForm={id:null,item:null,leadername:null,leaderphone:null,address:null,img:""}},clickAddOrUp(){this.centerDialogVisible=!0,this.addOrUpTit="创建再利用企业",this.clearForm()},handleEdit(e,t){console.log(e,t);this.centerDialogVisible=!0,this.addOrUpTit="编辑再利用企业",this.addForm={id:t.id,name:t.name,leadername:t.leadername,leaderphone:t.leaderphone,address:t.address,img:t.img}},addSaveForm(){console.log(this.addForm);var e=this;if(null!=this.addForm.name&&null!=this.addForm.leadername&&null!=this.addForm.leaderphone&&null!=this.addForm.address)if(""!=this.addForm.img){var t=this.$qs.stringify(this.addForm,{indices:!1});"创建再利用企业"==this.addOrUpTit?this.$ajax.post("/recovery/productionplant//insert ",t).then(function(t){260==t.data.status&&(e.centerDialogVisible=!1,e.$message.success("添加成功"),e.getData(),e.clearForm())}):this.$ajax.put("/recovery/productionplant/update",t).then(function(t){260==t.data.status&&(e.centerDialogVisible=!1,e.$message.success("编辑成功"),e.getData(),e.clearForm())})}else this.$message.error("营业执照为必填项！");else this.$message.error("*为必填项！")},delAll(){if(this.multipleSelection.length<1)return this.$message.success("请先选择删除对象");this.$confirm("此操作将永久删除选中的再利用企业, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.multipleSelection.length==this.tableData.length&&(this.page=Number(this.page)-1);var e=this;this.$ajax.delete("/recovery/productionplant/deletes",{data:this.multipleSelection}).then(function(t){260==t.data.status&&(e.$message.success("删除成功"),e.getData())})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},handleSelectionChange(e){this.multipleSelection=[];for(var t=0;t<e.length;t++)this.multipleSelection.push(e[t].id);console.log(this.multipleSelection)},handleDelete(e,t){this.$confirm("此操作将删除该再利用企业, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{console.log(e,t),1==this.tableData.length&&(this.page=Number(this.page)-1);var a=this;this.$ajax.delete("/recovery/productionplant/delete",{params:{id:t}}).then(function(e){260==e.data.status&&(a.$message.success("删除成功"),a.getData())})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},getJoinSelectList(){var e=this,t={value:"",text:"全部"},a={id:"",username:"全部"};this.$ajax.get("/recovery/user/selectByRoleAndBelongId",{params:{belongid:sessionStorage.getItem("belongId"),role:"审核员",type:sessionStorage.getItem("userType")}}).then(function(t){console.log("申报人列表",t),e.submitList=t.data.list,e.submitList.unshift(a)}),this.$ajax.get("/recovery/truckproductionplant/statusList").then(function(a){console.log("status列表",a),e.statusList=a.data.list,e.statusList.unshift(t)})},clearJoinSelect(){this.joinForm={treatmentplantid:null,status:null,submitid:null,starttime:null,endtime:null,confirmid:null},this.lookJoinList(this.joinid)},lookJoinList(e){this.joinid=e,this.shengchanIf=!0;var t=this;null==this.joinForm.starttime&&(this.joinForm.starttime=""),null==this.joinForm.endtime&&(this.joinForm.endtime=""),console.log(this.joinForm),this.$ajax.get("/recovery/truckproductionplant/selectVByPage",{params:{page:this.page,rows:this.pageSize,productionplantid:e,treatmentplantid:this.joinForm.treatmentplantid,submituserid:this.joinForm.submitid,confirmuserid:this.joinForm.confirmid,status:this.joinForm.status,name:this.joinForm.name,begintime:""==this.joinForm.starttime?"":new Date(this.joinForm.starttime)/1e3*1e3,endtime:""==this.joinForm.endtime?"":new Date(this.joinForm.endtime)/1e3*1e3}}).then(function(e){console.log(e),260==e.data.status?(t.joinTableData=e.data.list,t.jtotalNum=e.data.info.total):(t.joinTableData=[],t.jtotalNum=0)})},changeJoinPage(e){this.jpage=e,this.lookJoinList(this.joinid)},selectJoinList(){this.jpage=1,this.lookJoinList(this.joinid)}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"yudingBox"}},[a("div",{staticClass:"selectBox"},["系统"==e.userType?a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"再利用企业名称"}},[a("el-input",{on:{change:e.selectList},model:{value:e.form.item,callback:function(t){e.$set(e.form,"item",t)},expression:"form.item"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人","label-width":"70px"}},[a("el-input",{on:{change:e.selectList},model:{value:e.form.leadername,callback:function(t){e.$set(e.form,"leadername",t)},expression:"form.leadername"}})],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"30px"}},[a("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"warning",size:"small"},on:{click:e.clearSelect}},[e._v("清空筛选")])],1)],1):e._e()],1),e._v(" "),a("div",{staticClass:"tableBox"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"再利用企业名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"leadername",label:"负责人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"leaderphone",label:"负责人电话"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"地址"}}),e._v(" "),a("el-table-column",{attrs:{prop:"",label:"营业执照"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{staticStyle:{width:"90px",height:"70px"},attrs:{src:t.row.img},on:{click:function(a){return e.lookImg(t.row.img)}}})]}}])}),e._v(" "),"再利用企业"==e.userType?a("el-table-column",{attrs:{prop:"",label:"交接记录",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.lookJoinList(t.row.id)}}},[e._v("查看")])]}}],null,!1,3217133880)}):e._e(),e._v(" "),"系统"==e.userType?a("el-table-column",{attrs:{label:"操作",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.setAdminUser(t.row)}}},[e._v("设置管理员")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row.id)}}},[e._v("删除")])]}}],null,!1,4110725873)}):e._e()],1),e._v(" "),a("div",{staticClass:"pafinationBox"},[a("div",["系统"==e.userType?a("el-button",{attrs:{type:"primary"},on:{click:e.clickAddOrUp}},[e._v("添加再利用企业")]):e._e(),e._v(" "),"系统"==e.userType?a("el-button",{attrs:{type:"warning"},on:{click:e.delAll}},[e._v("批量删除")]):e._e()],1),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.pageSize,total:e.totalNum},on:{"current-change":e.changePage}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.addOrUpTit,visible:e.centerDialogVisible,width:"600px",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("div",{staticClass:"dialogMain"},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"再利用企业名称",required:""}},[a("el-input",{model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人",required:""}},[a("el-input",{model:{value:e.addForm.leadername,callback:function(t){e.$set(e.addForm,"leadername",t)},expression:"addForm.leadername"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人电话",required:""}},[a("el-input",{model:{value:e.addForm.leaderphone,callback:function(t){e.$set(e.addForm,"leaderphone",t)},expression:"addForm.leaderphone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地址",required:""}},[a("el-input",{model:{value:e.addForm.address,callback:function(t){e.$set(e.addForm,"address",t)},expression:"addForm.address"}})],1)],1),e._v(" "),a("div",{staticClass:"iptBox"},[a("span",[e._v("营业执照")]),e._v(" "),a("div",[a("aliUpFile",{attrs:{file:e.addForm.img,server:"/recovery",directory:"eproductionplant",fileNum:"1"},on:{fileDel:e.fileDels,upFileData:e.upFileDatas}})],1)])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addSaveForm()}}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"交接记录",visible:e.shengchanIf,width:"90%",center:""},on:{"update:visible":function(t){e.shengchanIf=t}}},[a("div",{staticClass:"dialogMains"},[a("div",{staticClass:"selectBox"},[a("el-form",{ref:"joinForm",attrs:{model:e.joinForm,"label-width":"60px"}},[a("el-form-item",{attrs:{label:"提交人"}},[a("el-select",{attrs:{placeholder:"请选择提交人"},on:{change:e.selectJoinList},model:{value:e.joinForm.submitid,callback:function(t){e.$set(e.joinForm,"submitid",t)},expression:"joinForm.submitid"}},e._l(e.submitList,function(e,t){return a("el-option",{key:t,attrs:{label:e.username,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{placeholder:"请选择状态"},on:{change:e.selectJoinList},model:{value:e.joinForm.status,callback:function(t){e.$set(e.joinForm,"status",t)},expression:"joinForm.status"}},e._l(e.statusList,function(e,t){return a("el-option",{key:t,attrs:{label:e.text,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"时间"}},[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"起始日期","value-format":"yyyy/MM/dd"},on:{change:e.selectJoinList},model:{value:e.joinForm.starttime,callback:function(t){e.$set(e.joinForm,"starttime",t)},expression:"joinForm.starttime"}})],1),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"结束日期","value-format":"yyyy/MM/dd"},on:{change:e.selectJoinList},model:{value:e.joinForm.endtime,callback:function(t){e.$set(e.joinForm,"endtime",t)},expression:"joinForm.endtime"}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"warning",size:"small"},on:{click:e.clearJoinSelect}},[e._v("清空筛选")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"tableBox"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.joinTableData}},[a("el-table-column",{attrs:{prop:"",label:"时间",width:"135",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[null==t.row.time?a("span"):a("span",[e._v(e._s(e._f("formatDate")(t.row.time)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"productionplant.name",label:"再利用企业"}}),e._v(" "),a("el-table-column",{attrs:{prop:"truck.vehicle.number",label:"车牌"}}),e._v(" "),a("el-table-column",{attrs:{prop:"plasticweight",label:"塑料重量(kg)"}}),e._v(" "),a("el-table-column",{attrs:{prop:"glassweight",label:"玻璃重量(kg)"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"}}),e._v(" "),a("el-table-column",{attrs:{prop:"submitUser.username",label:"提交人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"confirmUser.username",label:"确认人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"note",label:"备注"}})],1),e._v(" "),a("div",{staticClass:"pafinationBox"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.jpageSize,"current-page":e.jpage,total:e.jtotalNum},on:{"update:currentPage":function(t){e.jpage=t},"update:current-page":function(t){e.jpage=t},"current-change":e.changePage}})],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:"",visible:e.lookImgIf,width:"600px",center:""},on:{"update:visible":function(t){e.lookImgIf=t}}},[a("div",{staticClass:"dialogMain"},[a("img",{staticStyle:{width:"100%"},attrs:{src:e.imgLook}})])])],1)},staticRenderFns:[]};var s=a("VU/8")(i,l,!1,function(e){a("jTS0")},"data-v-06c49fb3",null);t.default=s.exports},jTS0:function(e,t){}});
//# sourceMappingURL=49.d6120a05df66ae8a6a3e.js.map