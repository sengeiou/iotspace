webpackJsonp([14],{"2Hbs":function(e,t){},FoIT:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={filters:{formatDate:function(e){var t=new Date(e),a=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),r=t.getHours(),o=t.getMinutes();return s<10&&(s="0"+s),r<10&&(r="0"+r),o<10&&(o="0"+o),a+"-"+s+"-"+l+" "+r+":"+o}},data:()=>({gsName:"",belongIf:!1,writeCardIfIs:!1,userId:sessionStorage.getItem("userId"),userType:sessionStorage.getItem("userType"),page:1,pageSize:5,totalNum:100,form:{phone:"",realname:"",starttime:"",endtime:""},addOrUpTit:"",addForm:{id:null,username:null,phone:null,note:null,realname:null,type:null,userid:sessionStorage.getItem("userId"),belongid:null,role:null},tableData:[],belongList:[],addBelongList:[],tableTypes:[],roleList:[],multipleSelection:[],centerDialogVisible:!1,endPickerOptions:{disabledDate:e=>e.getTime()<Date.now()-864e5}}),mounted(){this.getData(),this.getSelectList()},methods:{getSelectList(){var e=this,t={value:"",text:"全部"};this.$ajax.get("/recovery/user/typeList",{params:{type:sessionStorage.getItem("userType")}}).then(function(a){console.log("type列表",a),e.tableTypes=a.data.list,e.tableTypes.unshift(t)}),this.$ajax.get("/recovery/user/roleList",{params:{type:sessionStorage.getItem("userType")}}).then(function(a){console.log("role列表",a),e.roleList=a.data.list,e.roleList.unshift(t)}),this.$ajax.get("/recovery/user/userDetail",{params:{userid:sessionStorage.getItem("userId")}}).then(function(t){console.log(t),260==t.data.status&&(e.gsName=t.data.unit.name)})},getData(){var e=this;null==this.form.starttime&&(this.form.starttime=""),null==this.form.endtime&&(this.form.endtime="");var t="用户";"医疗机构"!=sessionStorage.getItem("userType")&&"回收利用企业"!=sessionStorage.getItem("userType")&&"再利用企业"!=sessionStorage.getItem("userType")&&"回收物流"!=sessionStorage.getItem("userType")||(t=null),this.$ajax.get("/recovery/user/selectByPage",{params:{page:this.page,rows:this.pageSize,phone:this.form.phone,realname:this.form.realname,type:sessionStorage.getItem("userType"),role:t,belongid:sessionStorage.getItem("belongId"),begintime:""==this.form.starttime?"":new Date(this.form.starttime)/1e3*1e3,endtime:""==this.form.endtime?"":new Date(this.form.endtime)/1e3*1e3}}).then(function(t){if(console.log(t),260==t.data.status){if(e.tableData=t.data.list,e.totalNum=t.data.info.total,"医疗机构"==sessionStorage.getItem("userType")||"回收利用企业"==sessionStorage.getItem("userType")||"再利用企业"==sessionStorage.getItem("userType")||"回收物流"==sessionStorage.getItem("userType"))for(var a=0;a<e.tableData.length;a++)"管理员"===e.tableData[a].role&&e.tableData.splice(a,1)}else e.tableData=[],e.totalNum=0,e.$message.error(t.data.message)})},changePage(e){this.page=e,this.getData()},selectList(){this.page=1,this.getData()},typeChange(e){var t=this;t.addForm.belongid=null,this.belongList=[],this.$ajax.get("/recovery/user/unitList",{params:{type:e}}).then(function(e){console.log(e),260==e.data.status&&(t.addBelongList=e.data.list)})},clearAddForm(){this.addForm={id:null,username:null,phone:null,note:null,realname:null,type:sessionStorage.getItem("userType"),userid:sessionStorage.getItem("userId"),belongid:sessionStorage.getItem("belongId"),role:"用户"},"医疗机构"!=sessionStorage.getItem("userType")&&"回收利用企业"!=sessionStorage.getItem("userType")&&"再利用企业"!=sessionStorage.getItem("userType")&&"回收物流"!=sessionStorage.getItem("userType")||(this.addForm.role=null)},clickAddOrUp(){this.centerDialogVisible=!0,this.addOrUpTit="新增用户",this.clearAddForm()},handleEdit(e,t){console.log(e,t),this.centerDialogVisible=!0,this.addOrUpTit="编辑用户",this.addForm={id:t.id,username:t.username,password:t.password,phone:t.phone,note:t.note,type:t.type,userid:sessionStorage.getItem("userId"),belongid:t.belongid,time:t.time,role:t.role,realname:t.realname}},addSaveForm(e){if(console.log(this.addForm),null==this.addForm.realname||null==this.addForm.role||null==this.addForm.username||null==this.addForm.phone||null==this.addForm.type||null==this.addForm.belongid)return this.$message.error("*为必填项！");var t=this,a=this.$qs.stringify(this.addForm,{indices:!1});"新增用户"==this.addOrUpTit?this.$ajax.post("/recovery/user/insert",a).then(function(e){260==e.data.status&&(t.centerDialogVisible=!1,t.$message.success("添加成功"),t.getData(),t.clearAddForm())}):this.$ajax.put("/recovery/user/update",a).then(function(e){260==e.data.status&&(t.centerDialogVisible=!1,t.$message.success("编辑成功"),t.getData(),t.clearAddForm())})},delAll(){this.$confirm("此操作将永久删除所选用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(this.multipleSelection.length<1)return this.$message.success("请先选择删除对象");this.multipleSelection.length==this.tableData.length&&(this.page=Number(this.page)-1);var e=this;this.$ajax.delete("/recovery/user/deletes",{data:this.multipleSelection}).then(function(t){260==t.data.status&&(e.$message.success("删除成功"),e.getData())})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},handleSelectionChange(e){this.multipleSelection=[];for(var t=0;t<e.length;t++)this.multipleSelection.push(e[t].id);console.log(this.multipleSelection)},handleDelete(e,t){console.log(e,t),this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{1==this.tableData.length&&(this.page=Number(this.page)-1);var e=this;this.$ajax.delete("/recovery/user/delete",{params:{id:t}}).then(function(t){260==t.data.status&&(e.$message.success("删除成功"),e.getData())})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"yudingBox"}},[a("div",{staticClass:"selectBox"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"65px"}},[a("el-form-item",{attrs:{label:"姓名","label-width":"40px"}},[a("el-input",{attrs:{placeholder:"请输入姓名"},on:{change:e.selectList},model:{value:e.form.realname,callback:function(t){e.$set(e.form,"realname",t)},expression:"form.realname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{attrs:{placeholder:"请输入手机号"},on:{change:e.selectList},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),"医疗机构"==e.userType||"回收利用企业"==e.userType||"再利用企业"==e.userType||"回收物流"==e.userType?a("el-form-item",{attrs:{label:"角色"}},[a("el-select",{attrs:{placeholder:"请选择用户角色"},on:{change:e.selectList},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},e._l(e.roleList,function(e,t){return a("el-option",{key:t,attrs:{label:e.text,value:e.value}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"时间"}},[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"起始日期","value-format":"yyyy/MM/dd"},on:{change:e.selectList},model:{value:e.form.starttime,callback:function(t){e.$set(e.form,"starttime",t)},expression:"form.starttime"}})],1),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"结束日期","value-format":"yyyy/MM/dd"},on:{change:e.selectList},model:{value:e.form.endtime,callback:function(t){e.$set(e.form,"endtime",t)},expression:"form.endtime"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"tableBox"},[a("p",{staticStyle:{height:"30px","font-size":"14px"}},[e._v("所属单位："+e._s(e.gsName))]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"realname",label:"姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role",label:"角色"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"note",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"注册时间",sortable:"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("formatDate")(t.row.time))+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"pafinationBox"},[a("div",[a("el-button",{attrs:{type:"primary"},on:{click:e.clickAddOrUp}},[e._v("新增用户")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.delAll}},[e._v("批量删除")])],1),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.pageSize,total:e.totalNum},on:{"current-change":e.changePage}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.addOrUpTit,visible:e.centerDialogVisible,width:"50%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("div",{staticClass:"dialogMain"},[a("el-form",{ref:"form",attrs:{model:e.addForm,"label-width":"100px"}},["医疗机构"==e.userType||"回收利用企业"==e.userType||"再利用企业"==e.userType||"回收物流"==e.userType?a("el-form-item",{attrs:{label:"角色",required:""}},[a("el-select",{attrs:{placeholder:"请选择用户角色"},model:{value:e.addForm.role,callback:function(t){e.$set(e.addForm,"role",t)},expression:"addForm.role"}},e._l(e.roleList,function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:"全部"!=e.text,expression:"item.text != '全部'"}],key:t,attrs:{label:e.text,value:e.value}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"用户名",required:""}},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"姓名",required:""}},[a("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.addForm.realname,callback:function(t){e.$set(e.addForm,"realname",t)},expression:"addForm.realname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号",required:""}},[a("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.addForm.phone,callback:function(t){e.$set(e.addForm,"phone",t)},expression:"addForm.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.note,callback:function(t){e.$set(e.addForm,"note",t)},expression:"addForm.note"}})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addSaveForm()}}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"所属单位",visible:e.belongIf,width:"50%",center:""},on:{"update:visible":function(t){e.belongIf=t}}},[a("div",{staticClass:"dialogMain"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.belongList}},[a("el-table-column",{attrs:{prop:"name",label:"单位名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"leadername",label:"单位领导"}}),e._v(" "),a("el-table-column",{attrs:{prop:"leaderphone",label:"领导电话"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"地址"}})],1)],1)])],1)},staticRenderFns:[]};var r=a("VU/8")(s,l,!1,function(e){a("2Hbs")},"data-v-dca2a82e",null);t.default=r.exports}});
//# sourceMappingURL=14.601c2cab969f2fdf7a84.js.map